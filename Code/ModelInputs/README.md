### Data Preprocessing and Model Inputs

This folder contains scripts for preprocessing MEG and diffusion MRI (dMRI) data and preparing input files for modeling. 
---

## **ðŸ“‚ Scripts and Outputs**

### **1. Early MEG Preprocessing (Script 1: `1_EarlyEvokedMEG.m`)**
- **Purpose:** Preprocess MEG data, apply ICA artifact rejection, and extract trial-averaged evoked responses for "verb" and "noise" conditions. Save sensor-level MEG data for later source localization in Script 4.
- **Dependencies:** MATLAB, FieldTrip toolbox.
- **Outputs (per subject):**
  - `verb.npy` â†’ NumPy array of averaged evoked responses for the "verb" condition.
  - `noise.npy` â†’ NumPy array of averaged evoked responses for the "noise" condition.
  - 'sensor_verb.mat' â†’ Raw sensor-level data (used in Script 4 for source localization).
  - 'sensor_noise.mat' â†’ Raw sensor-level data (used in Script 4 for source localization).


---

### **2. Distance Matrix Calculation (Script 2: `2_distancemat.m`)**
- **Purpose:** Generates a subject-specific Shen atlas in individual space and computes the Euclidean distance matrix between brain regions.
- **Dependencies:** MATLAB, SPM toolbox.
- **Outputs (per subject):**
  - `distance.txt` â†’ Distance matrix (Euclidean distance between brain regions).
  - `shen_in_individual_space_shen_atlas.nii` â†’ Subject-specific Shen atlas in individual space (used in Script 3).

---

### **3. Structural Connectivity Matrix Extraction (Script 3: `3_WeightsfromDwMRI.sh`)**
- **Purpose:** Processes diffusion MRI (dMRI) data to compute subject-specific structural connectivity matrices based on the Shen atlas.
- **Dependencies:** FreeSurfer, FSL, MRtrix3, ANTs.
- **Outputs (per subject):**
  - `shen_indiv.csv` â†’ Structural connectivity matrix (weights matrix used for modeling).

---

### **4. Source Localization & Leadfield Computation (Script 4: `4_SourceLocalization_Leadfield.m`)**
- **Purpose:** Compute individual leadfields to simulate MEG activity based on subject-specific anatomy (model input) and localize MEG sensor data to the source space for empirical validation in analysis.
- **Dependencies:** MATLAB, FieldTrip, Individual MRI
- **Outputs (per subject):**
  - `leadfield_3d.mat` â†’ Leadfield formatted as a 3D array (for modeling).
  - `source_verb_trialts.mat` â†’ Source trial time series for verb condition.
  - `source_noise_trialts.mat` â†’ Source trial time series for noise condition.

---
## **ðŸ“Š Summary of Model Inputs**
| File Name | Generated By | Description |
|-----------|-------------|-------------|
| `verb.npy` | `1_EarlyEvokedMEG.m` | Averaged evoked response for verb trials (NumPy format). |
| `noise.npy` | `1_EarlyEvokedMEG.m` | Averaged evoked response for noise trials (NumPy format). |
| `distance.txt` | `2_distancemat.m` | Euclidean distance matrix between brain regions. |
| `shen_indiv.csv` | `3_WeightsfromDwMRI.sh` | Structural connectivity matrix (weights for modeling). |
| `leadfield_3d.mat` | `4_SourceLocalization_Leadfield.m` | Individual leadfield matrix (used in the model for simulating MEG). |

---

## **ðŸ’¡ Usage Instructions**
### **Step 1: Preprocess MEG Data**
Run `1_EarlyEvokedMEG.m` in MATLAB to generate `verb.npy` and `noise.npy` files.

### **Step 2: Generate Distance Matrix**
Run `2_distancemat.m` in MATLAB to compute `distance.txt` and generate `shen_in_individual_space_shen_atlas.nii`.

### **Step 3: Compute Structural Connectivity**
Run `3_WeightsfromDwMRI.sh` on a high-performance computing cluster or Linux environment to generate `shen_indiv.csv`, uses `shen_in_individual_space_shen_atlas.nii` from step 2.

### **Step 4: Source Localization & Leadfield Computation**
Run `4_SourceLocalization_Leadfield.m` in MATLAB to compute `leadfield_3d.mat` for simulating MEG and perform source localization to generate `source_verb_trialts.mat` and `source_noise_trialts.mat` for empirical comparison.
