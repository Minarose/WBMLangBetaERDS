# Model Outputs - Simulations

This directory contains simulated time series data generated by the Jansen-Rit neural mass model after model fitting and testing.

---

## **Generated Files**

The simulation files are created by the last two lines of `Code/JR_Model_Fitting.py` (lines 1583-1584):

### **1. Source Space Time Series**
- **File naming pattern:** `{subject}_{run}_pred1500_source_ts.npy`
- **Description:** Simulated source-space neural activity time series
- **Format:** NumPy array
- **Content:** Contains `F.output_sim.P_test` - the main population (P) activity from the Jansen-Rit model in source space
- **Dimensions:** (number of brain regions × time points)
- **Usage:** Used for analyzing simulated neural dynamics at the source level

### **2. Sensor Space Time Series**
- **File naming pattern:** `{subject}_{run}_pred1500_sensor_ts.npy`
- **Description:** Simulated MEG sensor-space time series (forward-projected from source space)
- **Format:** NumPy array
- **Content:** Contains `F.output_sim.eeg_test` - the simulated MEG/EEG signals projected to sensor space using the leadfield matrix
- **Dimensions:** (number of MEG sensors × time points)
- **Usage:** Used for comparing simulated MEG signals with empirical MEG data

---

## **Directory Structure**

The simulation outputs are organized into two subdirectories:

### **`Source_Space/`**
Contains source-space time series files with naming convention:
- `sub-{ID}-{age}Y_{condition}_source_timeseries.npy`
- Example: `sub-01-16Y_verb_source_timeseries.npy`

### **`Sensor_Space/`**
Contains sensor-space time series files with naming convention:
- `sub-{ID}-{age}Y_{condition}_sensor_timeseries.npy`
- Example: `sub-01-16Y_verb_sensor_timeseries.npy`

---

## **Generation Process**

These files are created during the **test phase** of model fitting:

1. **Model Training:** The model is first trained on empirical MEG data (lines 1546-1552)
2. **Extended Simulation:** The data is extended to 1500 time points (line 1559)
3. **Test Simulation:** The fitted model is used to generate predictions via `F.test()` (line 1576)
4. **File Saving:** The simulated time series are saved as NumPy arrays (lines 1583-1584)

**Code Reference:**
```python
# Lines 1581-1584 in JR_Model_Fitting.py
source_file = output_path + '/' + sub + '_' + run + '_pred1500_source_ts.npy'
sensor_file = output_path + '/' + sub + '_' + run + '_pred1500_sensor_ts.npy'
np.save(source_file, F.output_sim.P_test)
np.save(sensor_file, F.output_sim.eeg_test)
```

---

## **File Naming Convention**

- **`{subject}`**: Subject identifier (e.g., `CTL_01_16`)
- **`{run}`**: Condition name (e.g., `verb`, `noise`)
- **`pred1500`**: Indicates prediction extended to 1500 time points
- **`source_ts`** or **`sensor_ts`**: Indicates source-space or sensor-space time series

---

## **Usage**

These simulation files can be loaded and analyzed using:

```python
import numpy as np

# Load source space time series
source_ts = np.load('{subject}_{run}_pred1500_source_ts.npy')

# Load sensor space time series
sensor_ts = np.load('{subject}_{run}_pred1500_sensor_ts.npy')
```

The simulated time series can then be compared with empirical MEG data for model validation and analysis.

