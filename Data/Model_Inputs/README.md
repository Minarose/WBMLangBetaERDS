# Model Inputs - Subject File Descriptions

This directory contains subject-specific input files to construct the individual whole-brain model. Each subject folder (e.g., `CTL_01_16F/`) contains the following files:

---

## **Core Model Input Files** (Required)

These files are essential for running the model and are generated by the preprocessing scripts in `Code/ModelInputs/`.

### **1. `verb_evoked.npy`**
- **Description:** NumPy array containing the trial-averaged evoked MEG response for the "verb" condition
- **Format:** NumPy array (sensors × time points)
- **Generated by:** `1_EarlyEvokedMEG.m` (Script 1)
- **Usage:** Used as empirical data for model fitting in `JR_Model_Fitting.py`
- **Note:** This is the averaged response across all verb trials after preprocessing (ICA artifact rejection, filtering, resampling)

### **2. `noise_evoked.npy`**
- **Description:** NumPy array containing the trial-averaged evoked MEG response for the "noise" condition
- **Format:** NumPy array (sensors × time points)
- **Generated by:** `1_EarlyEvokedMEG.m` (Script 1)
- **Usage:** Used as empirical data for model fitting and comparison
- **Note:** This is the averaged response across all noise trials after preprocessing

### **3. `distance.txt`**
- **Description:** Euclidean distance matrix between brain regions (parcels) in the Shen atlas
- **Format:** Tab-delimited text file (N × N matrix, where N = number of brain regions)
- **Generated by:** `2_distancemat.m` (Script 2)
- **Usage:** Used in the model to compute conduction delays between brain regions based on physical distance
- **Units:** Typically in millimeters (mm)
- **Note:** Computed from the centroids of each Shen atlas parcel in individual subject space

### **4. `shen_indiv.csv`** (or `weights.csv`)
- **Description:** Structural connectivity matrix derived from diffusion-weighted MRI (dMRI) tractography
- **Format:** CSV file (N × N matrix, where N = number of brain regions)
- **Generated by:** `3_WeightsfromDwMRI.sh` (Script 3)
- **Usage:** Used as the structural connectivity (SC) matrix in the model, representing the strength of white matter connections between brain regions
- **Note:** 
  - Values represent the number or density of streamlines connecting regions
  - The model normalizes this matrix: `np.log1p(sc) / np.linalg.norm(np.log1p(sc))`

### **5. `leadfield_3d.mat`**
- **Description:** Leadfield matrix in 3D format for forward modeling (source-to-sensor projection)
- **Format:** MATLAB .mat file containing a 3D array
- **Generated by:** `4_SourceLocalization_Leadfield.m` (Script 4)
- **Usage:** 
  - Used to project simulated source-space activity to sensor space (MEG channels)
  - Loaded in `JR_Model_Fitting.py` as `leadfield['M']` and processed via SVD to create the leadfield matrix `lm`
- **Structure:** 
  - 3D array: (sources × sensors × orientations)
  - Converted to 2D format (sensors × sources) in the model using SVD

---

## **File Usage in Model Fitting**

The main model fitting script (`JR_Model_Fitting.py`) uses the following files:

1. **`verb_evoked.npy`** or **`noise_evoked.npy`** → Loaded as `meg_data` (empirical MEG data) via `{run}.npy`
2. **`shen_indiv.csv`** → Loaded as `sc` (structural connectivity matrix)
3. **`distance.txt`** → Loaded as `dist` (distance matrix for delay computation)
4. **`leadfield_3d.mat`** → Loaded and processed to create `lm` (leadfield matrix for forward modeling)

---

## **File Naming Conventions**

- Subject folders are named: `CTL_XX_YYZ/` where:
  - `CTL` = Control group
  - `XX` = Subject number
  - `YY` = Age
  - `Z` = Gender (M/F)

- Some subjects may have additional subdirectories (e.g., `FULL/`) containing extended time series data

---

## **Data Processing Pipeline**

For details on how these files are generated, see the scripts in `Code/ModelInputs/`:

1. **Script 1** (`1_EarlyEvokedMEG.m`): Generates `verb_evoked.npy` and `noise_evoked.npy`
2. **Script 2** (`2_distancemat.m`): Generates `distance.txt`
3. **Script 3** (`3_WeightsfromDwMRI.sh`): Generates `shen_indiv.csv`
4. **Script 4** (`4_SourceLocalization_Leadfield.m`): Generates `leadfield_3d.mat`

See `Code/ModelInputs/README.md` for detailed information about each preprocessing script.
